{% load render_table from django_tables2 %}
<div _="on load if #argsDialog is not null remove #argsDialog"></div>
<div class="row">
  <div class="col-md-auto">
    <form>
      {% csrf_token %}
      {% render_table table %}
    </form>
  </div>
  <div class="col-md-auto">
    <pre class="mermaid">
      flowchart TD

      %% FSM states (nodes).
      classDef default fill:#b5b3ae,stroke:black,stroke-width:2px

      %% FSM transitions (edges).
      linkStyle default background-color:#b5b3ae,stroke-width:2px

      {{ flowchart }}
    </pre>
  </div>
</div>
<script>
  // Initialize mermaid diagrams.
  mermaid.initialize({
    theme: "base",
    // Make flowchart text uppercase.
    themeCSS: ".label { text-transform: uppercase; }",
    themeVariables: {
      primaryTextColor: "white",
      edgeLabelBackground: "transparent", // HACK: custom edge label colour
    },
  });
  // Refresh mermaid diagrams after htmx swap.
  document.body.addEventListener("htmx:afterSwap", (event) => {
      const target = event.detail.target;
      if (target && target.querySelector(".mermaid")) {
          mermaid.run({nodes: target.querySelectorAll(".mermaid")});
      }
  });
</script>
